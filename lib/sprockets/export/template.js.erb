<%= @head %>

(function() {
<%= "  var context = {};\n" if @flags.noglobal -%>
  (function() {
    <%= indent(@export, 4 )%>
  }).call(<%= @flags.noglobal ? "context" : "this" %>);

  var <%= @namespace %> = <%= @flags.noglobal  ? "context" : "this" %>.<%= @namespace %>;

  (function() {
    <%= indent(@tail, 4) %>
  }).call(this);

  if (typeof module === "object" && module.exports) {
    module.exports = <%= @namespace %>;
  } else if (typeof define === "function" && define.amd) {
    define(<%= @namespace %>);
  }
}).call(this);
